### 课堂笔记

#### virtual memory（lab3）
- 建立在lab1和lab2之上
- lab1:启动，加载os；中断和异常的处理
	- 基于x86:进入保护模式，建立段表GDT（全局描述符表），建立IDT（中断描述符表）（256项），进入trap
	- 处理中断和异常的区别：会不会重复执行产生中断或异常的指令（返回时执行的语句不同）
	- 基于v9:
- lab2:物理内存管理
	- os如何知道系统有多少内存？对x86，有一个叫E820的数据结构，通过BIOS获取系统有多少内存。对v9而言，用msize指令就可以得到物理内存大小
	- 非连续物理内存的管理：建立页表
	- x86和v9建立页表的方式有什么不同？
	- 页表在内存中，是一块特殊的内存区域
	- 页目录项PD，页表项PT，类似于指针，PD指向PT，PT指向物理地址
	- 虚实地址的转换不需要每次都经过页表，可以使用TLB，x86和v9都有TLB（它是页表的cache）
	- x86通过CR3寄存器得到页表的起始地址，v9通过pdir指令得到页表的起始地址（物理地址）（4k对齐：如果不4k对齐会直接报错）
	- 页表内部结构：x86:页表项：低12位地址放标志位，高20位地址放起始地址
	- 虚地址到物理地址的映射：将32位地址分为10，10，12，分别为PDI，PTI，OFFSET。然后从页目录、页表项中查找物理地址
	- CPU会做，os只需要做补充的事：1.中断时CPU会保存一些状态，os会进一步保存一些状态。2.clock算法中清除标志位是CPU做
	- 建立完页表项后要enable页表
- lab3:虚拟内存管理
	- 分配的虚拟内存空间大于实际上的物理空间
	- 需要处理页访问的异常
	- 将不常使用的进程换到硬盘中保存起来，v9用memory区域模拟disk，所以这步操作相当于memory copy
- 缺页异常处理
	- 以v9为例
	- 缺页异常：用户态的权限错误；访问的地址不合法（有没有映射关系etc）

